function autocompletar(idCampo, idSugerencias, lista, callback) {
  const campo = document.getElementById(idCampo);
  const contenedor = document.getElementById(idSugerencias);
  let indice = -1;

  campo.addEventListener("input", () => {
    const valor = campo.value.toLowerCase().trim();
    contenedor.innerHTML = "";
    indice = -1;
    if (!valor) return;
    const sugerencias = lista.filter(item => item.toLowerCase().includes(valor));
    sugerencias.forEach((s, i) => {
      const div = document.createElement("div");
      div.textContent = s;
      div.className = "sugerencia";
      div.dataset.index = i;
      contenedor.appendChild(div);
    });
  });

  campo.addEventListener("keydown", e => {
    const items = contenedor.querySelectorAll(".sugerencia");
    if (items.length === 0) return;

    if (e.key === "ArrowDown") {
      e.preventDefault();
      indice = (indice + 1) % items.length;
      resaltar(items, indice);
    } else if (e.key === "ArrowUp") {
      e.preventDefault();
      indice = (indice - 1 + items.length) % items.length;
      resaltar(items, indice);
    } else if (e.key === "Enter") {
      e.preventDefault();
      if (indice >= 0 && items[indice]) {
        campo.value = items[indice].textContent;
        contenedor.innerHTML = "";
        if (callback) callback(campo.value);
      }
    }
  });

  function resaltar(items, i) {
    items.forEach(el => el.classList.remove("resaltado"));
    items[i].classList.add("resaltado");
  }
}